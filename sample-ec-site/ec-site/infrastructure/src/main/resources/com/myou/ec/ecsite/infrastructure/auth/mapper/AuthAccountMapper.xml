<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.myou.ec.ecsite.infrastructure.auth.mapper.AuthAccountMapper">

    <resultMap id="AuthAccountRecordMap"
               type="com.myou.ec.ecsite.infrastructure.auth.record.AuthAccountRecord">

        <id     column="AUTH_ACCOUNT_ID"   property="authAccountId"/>
        <result column="USER_ID"        property="userId"/>
        <result column="LOGIN_PASSWORD" property="loginPassword"/>
        <result column="ENABLED_FLG"    property="enabled"/>
        <result column="DELETED_FLG"    property="deleted"/>
        <result column="CREATED_AT"     property="createdAt"/>
        <result column="CREATED_BY"     property="createdBy"/>
        <result column="UPDATED_AT"     property="updatedAt"/>
        <result column="UPDATED_BY"     property="updatedBy"/>
        <result column="VERSION_NO"     property="versionNo"/>
    </resultMap>

    <select id="findById" resultMap="AuthAccountRecordMap">
        SELECT
            AUTH_ACCOUNT_ID,
            USER_ID,
            LOGIN_PASSWORD,
            ENABLED_FLG,
            DELETED_FLG,
            CREATED_AT,
            CREATED_BY,
            UPDATED_AT,
            UPDATED_BY,
            VERSION_NO
        FROM AUTH_ACCOUNT
        WHERE AUTH_ACCOUNT_ID = #{authAccountId}
    </select>

    <select id="findByUserId" resultMap="AuthAccountRecordMap">
        SELECT
            AUTH_ACCOUNT_ID,
            USER_ID,
            LOGIN_PASSWORD,
            ENABLED_FLG,
            DELETED_FLG,
            CREATED_AT,
            CREATED_BY,
            UPDATED_AT,
            UPDATED_BY,
            VERSION_NO
        FROM AUTH_ACCOUNT
        WHERE USER_ID = #{userId}
    </select>

    <insert id="insert"
            parameterType="com.myou.ec.ecsite.infrastructure.auth.record.AuthAccountRecord"
            useGeneratedKeys="true"
            keyProperty="authAccountId">
        INSERT INTO AUTH_ACCOUNT (
            USER_ID,
            LOGIN_PASSWORD,
            ENABLED_FLG,
            DELETED_FLG,
            CREATED_AT,
            CREATED_BY,
            UPDATED_AT,
            UPDATED_BY,
            VERSION_NO
        ) VALUES (
            #{userId},
            #{loginPassword},
            #{enabled},
            #{deleted},
            #{createdAt},
            #{createdBy},
            #{updatedAt},
            #{updatedBy},
            #{versionNo}
        )
    </insert>

    <update id="update"
            parameterType="com.myou.ec.ecsite.infrastructure.auth.record.AuthAccountRecord">
        UPDATE AUTH_ACCOUNT
        SET
            USER_ID        = #{userId},
            LOGIN_PASSWORD = #{loginPassword},
            ENABLED_FLG    = #{enabled},
            DELETED_FLG    = #{deleted},
            UPDATED_AT     = #{updatedAt},
            UPDATED_BY     = #{updatedBy},
            VERSION_NO     = VERSION_NO + 1
        WHERE AUTH_ACCOUNT_ID = #{authAccountId}
          AND VERSION_NO   = #{versionNo}
    </update>

</mapper>
