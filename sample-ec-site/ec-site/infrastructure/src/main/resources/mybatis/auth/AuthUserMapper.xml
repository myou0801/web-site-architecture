<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.myou.ec.ecsite.infrastructure.auth.mapper.AuthUserMapper">

    <resultMap id="AuthUserRecordMap"
               type="com.myou.ec.ecsite.infrastructure.auth.record.AuthUserRecord">

        <id     column="AUTH_USER_ID"   property="authUserId"/>
        <result column="LOGIN_ID"       property="loginId"/>
        <result column="LOGIN_PASSWORD" property="loginPassword"/>
        <result column="ENABLED_FLG"    property="enabled"/>
        <result column="DELETED_FLG"    property="deleted"/>
        <result column="CREATED_AT"     property="createdAt"/>
        <result column="CREATED_BY"     property="createdBy"/>
        <result column="UPDATED_AT"     property="updatedAt"/>
        <result column="UPDATED_BY"     property="updatedBy"/>
        <result column="VERSION_NO"     property="versionNo"/>
    </resultMap>

    <select id="findById" resultMap="AuthUserRecordMap">
        SELECT
            AUTH_USER_ID,
            LOGIN_ID,
            LOGIN_PASSWORD,
            ENABLED_FLG,
            DELETED_FLG,
            CREATED_AT,
            CREATED_BY,
            UPDATED_AT,
            UPDATED_BY,
            VERSION_NO
        FROM AUTH_USER
        WHERE AUTH_USER_ID = #{authUserId}
    </select>

    <select id="findByLoginId" resultMap="AuthUserRecordMap">
        SELECT
            AUTH_USER_ID,
            LOGIN_ID,
            LOGIN_PASSWORD,
            ENABLED_FLG,
            DELETED_FLG,
            CREATED_AT,
            CREATED_BY,
            UPDATED_AT,
            UPDATED_BY,
            VERSION_NO
        FROM AUTH_USER
        WHERE LOGIN_ID = #{loginId}
    </select>

    <insert id="insert"
            parameterType="com.myou.ec.ecsite.infrastructure.auth.record.AuthUserRecord"
            useGeneratedKeys="true"
            keyProperty="authUserId">
        INSERT INTO AUTH_USER (
            LOGIN_ID,
            LOGIN_PASSWORD,
            ENABLED_FLG,
            DELETED_FLG,
            CREATED_AT,
            CREATED_BY,
            UPDATED_AT,
            UPDATED_BY,
            VERSION_NO
        ) VALUES (
            #{loginId},
            #{loginPassword},
            #{enabled},
            #{deleted},
            #{createdAt},
            #{createdBy},
            #{updatedAt},
            #{updatedBy},
            #{versionNo}
        )
    </insert>

    <update id="update"
            parameterType="com.myou.ec.ecsite.infrastructure.auth.record.AuthUserRecord">
        UPDATE AUTH_USER
        SET
            LOGIN_ID       = #{loginId},
            LOGIN_PASSWORD = #{loginPassword},
            ENABLED_FLG    = #{enabled},
            DELETED_FLG    = #{deleted},
            UPDATED_AT     = #{updatedAt},
            UPDATED_BY     = #{updatedBy},
            VERSION_NO     = VERSION_NO + 1
        WHERE AUTH_USER_ID = #{authUserId}
          AND VERSION_NO   = #{versionNo}
    </update>

</mapper>
