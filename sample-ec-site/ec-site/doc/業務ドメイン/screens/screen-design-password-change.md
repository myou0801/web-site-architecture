# パスワード変更画面 設計書

## 1. 概要

- **画面名**: パスワード変更画面
- **URL**: `/account/password/change`
- **ファイルパス**: `presentation/src/main/resources/templates/account/passwordChange.html` (想定)
- **概要**: ユーザーが自身のパスワードを変更するための画面。
    - ログイン後にパスワードの変更が必須と判断された場合（初期パスワード、有効期限切れなど）に強制的に遷移する。

## 2. 画面レイアウト

```
+------------------------------------------------+
|                                                |
|            ECサイト - パスワード変更           |
|                                                |
+------------------------------------------------+
|                                                |
|  エラーメッセージがここに表示されます          |
|                                                |
|  現在のパスワード: [_________________] (●●●●●●●)   |
|                                                |
|  新しいパスワード: [_________________] (●●●●●●●)   |
|                                                |
|  新しいパスワード(確認): [_________________] (●●●●●●●) |
|                                                |
|                                                |
|             [ 変更 ]                           |
|                                                |
+------------------------------------------------+
```

## 3. 画面項目一覧

| No. | 項目名                 | 項目ID (`name`属性) | 型         | 必須 | 説明                           | バリデーション (クライアントサイド) |
|:----|:-----------------------|:--------------------|:-----------|:----:|:-------------------------------|:------------------------------------|
| 1   | 現在のパスワード       | `currentPassword`   | パスワード   | ○    | 現在設定されているパスワード     | ・必須入力チェック                |
| 2   | 新しいパスワード       | `newPassword`       | パスワード   | ○    | 新しく設定したいパスワード       | ・必須入力チェック<br>・パスワードポリシーに準拠 |
| 3   | 新しいパスワード(確認) | `confirmPassword`   | パスワード   | ○    | 新しいパスワードの再入力         | ・必須入力チェック<br>・新しいパスワードと一致 |

## 4. アクション

| No. | アクション名 | 概要                                       | 成功時の遷移           | 失敗時の処理                               |
|:----|:-------------|:-------------------------------------------|:-----------------------|:-------------------------------------------|
| 1   | 変更         | 入力されたパスワードで変更処理を呼び出す | パスワード変更完了画面へ遷移 | ・バリデーションエラー: 画面上部にエラーメッセージを表示 |

## 5. 関連仕様

### パスワードポリシー
本画面でのパスワード変更時は、サーバーサイドで以下のチェックが行われます。これは `GEMINI.md` の「3.3 パスワードポリシー」に基づく仕様です。

- **最小桁数**: 5
- **文字種**: 英数字
- **禁止事項**:
    - ユーザーIDとパスワードの完全一致
    - 直近3世代と同じパスワードの使用
- **有効期限**: 90日

## 6. エラーメッセージ一覧

| No. | 表示条件                               | メッセージ内容                                     |
|:----|:---------------------------------------|:---------------------------------------------------|
| 1   | 現在のパスワードが間違っている場合     | 現在のパスワードが正しくありません。               |
| 2   | 新しいパスワードがポリシーに違反する場合 | 新しいパスワードはポリシーの要件を満たしていません。システム管理者に要件を確認してください。 |
| 3   | 新しいパスワードと確認用が一致しない場合 | 新しいパスワードと確認用パスワードが一致しません。 |
| 4   | 新しいパスワードが現在のパスワードと同じ場合 | 現在のパスワードと同じパスワードは設定できません。 |
| 5   | 新しいパスワードが過去3回以内のパスワードと同じ場合 | 以前使用したパスワードは設定できません。          |
